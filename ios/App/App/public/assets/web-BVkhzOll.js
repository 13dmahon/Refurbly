import{W as N}from"./index-C5kOux9O.js";import{getAuth as i,applyActionCode as S,createUserWithEmailAndPassword as C,confirmPasswordReset as f,deleteUser as O,fetchSignInMethodsForEmail as y,getRedirectResult as v,OAuthProvider as a,isSignInWithEmailLink as U,EmailAuthProvider as g,FacebookAuthProvider as d,GithubAuthProvider as h,GoogleAuthProvider as R,RecaptchaVerifier as w,linkWithPhoneNumber as _,TwitterAuthProvider as I,reload as k,revokeAccessToken as P,sendEmailVerification as T,sendPasswordResetEmail as A,sendSignInLinkToEmail as W,setPersistence as E,signInAnonymously as G,signInWithCustomToken as L,signInWithEmailAndPassword as D,signInWithEmailLink as V,signInWithPhoneNumber as M,unlink as H,updateEmail as F,updatePassword as B,updateProfile as x,connectAuthEmulator as p,verifyBeforeUpdateEmail as $,signInWithRedirect as Y,signInWithPopup as j,linkWithRedirect as K,linkWithPopup as q,linkWithCredential as J,OAuthCredential as z,getAdditionalUserInfo as Q,inMemoryPersistence as X,indexedDBLocalPersistence as Z,browserSessionPersistence as b,browserLocalPersistence as ee}from"./index.esm-BUVxWX_n.js";import"./index.esm2017-Bi2ccvWJ.js";import{ProviderId as c,Persistence as m}from"./index-ZhW3wx-d.js";class s extends N{constructor(){super(),this.lastConfirmationResult=new Map;const e=i();e.onAuthStateChanged(t=>this.handleAuthStateChange(t)),e.onIdTokenChanged(t=>void this.handleIdTokenChange(t))}async applyActionCode(e){const t=i();return S(t,e.oobCode)}async createUserWithEmailAndPassword(e){const t=i(),r=await C(t,e.email,e.password);return this.createSignInResult(r,null)}async confirmPasswordReset(e){const t=i();return f(t,e.oobCode,e.newPassword)}async confirmVerificationCode(e){const{verificationCode:t,verificationId:r}=e,n=this.lastConfirmationResult.get(r);if(!n)throw new Error(s.ERROR_CONFIRMATION_RESULT_MISSING);const o=await n.confirm(t);return this.createSignInResult(o,null)}async deleteUser(){const t=i().currentUser;if(!t)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return O(t)}async fetchSignInMethodsForEmail(e){const t=i();return{signInMethods:await y(t,e.email)}}async getPendingAuthResult(){this.throwNotAvailableError()}async getCurrentUser(){const e=i();return{user:this.createUserResult(e.currentUser)}}async getIdToken(e){const t=i();if(!t.currentUser)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return{token:await t.currentUser.getIdToken(e?.forceRefresh)||""}}async getIdTokenResult(e){const t=i();if(!t.currentUser)throw new Error(s.ERROR_NO_USER_SIGNED_IN);const r=await t.currentUser.getIdTokenResult(e?.forceRefresh);return Object.assign(Object.assign({},r),{authTime:Date.parse(r.authTime),expirationTime:Date.parse(r.expirationTime),issuedAtTime:Date.parse(r.issuedAtTime)})}async getRedirectResult(){const e=i(),t=await v(e),r=t?a.credentialFromResult(t):null;return this.createSignInResult(t,r)}async getTenantId(){return{tenantId:i().tenantId}}async isSignInWithEmailLink(e){const t=i();return{isSignInWithEmailLink:U(t,e.emailLink)}}async linkWithApple(e){const t=new a(c.APPLE);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithEmailAndPassword(e){const t=g.credential(e.email,e.password),r=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(r,t)}async linkWithEmailLink(e){const t=g.credentialWithLink(e.email,e.emailLink),r=await this.linkCurrentUserWithCredential(t);return this.createSignInResult(r,t)}async linkWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=d.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithGameCenter(){this.throwNotAvailableError()}async linkWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=h.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=R.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithMicrosoft(e){const t=new a(c.MICROSOFT);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithOpenIdConnect(e){const t=new a(e.providerId);this.applySignInOptions(e,t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithPhoneNumber(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);if(!e.phoneNumber)throw new Error(s.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof w))throw new Error(s.ERROR_RECAPTCHA_VERIFIER_MISSING);try{const n=await _(r,e.phoneNumber,e.recaptchaVerifier),{verificationId:o}=n;this.lastConfirmationResult.set(o,n);const u={verificationId:o};this.notifyListeners(s.PHONE_CODE_SENT_EVENT,u)}catch(n){const o={message:this.getErrorMessage(n)};this.notifyListeners(s.PHONE_VERIFICATION_FAILED_EVENT,o)}}async linkWithPlayGames(){this.throwNotAvailableError()}async linkWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=I.credentialFromResult(r);return this.createSignInResult(r,n)}async linkWithYahoo(e){const t=new a(c.YAHOO);this.applySignInOptions(e||{},t);const r=await this.linkCurrentUserWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async reload(){const t=i().currentUser;if(!t)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return k(t)}async revokeAccessToken(e){const t=i();return P(t,e.token)}async sendEmailVerification(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return T(r,e?.actionCodeSettings)}async sendPasswordResetEmail(e){const t=i();return A(t,e.email,e.actionCodeSettings)}async sendSignInLinkToEmail(e){const t=i();return W(t,e.email,e.actionCodeSettings)}async setLanguageCode(e){const t=i();t.languageCode=e.languageCode}async setPersistence(e){const t=i();switch(e.persistence){case m.BrowserLocal:await E(t,ee);break;case m.BrowserSession:await E(t,b);break;case m.IndexedDbLocal:await E(t,Z);break;case m.InMemory:await E(t,X);break}}async setTenantId(e){const t=i();t.tenantId=e.tenantId}async signInAnonymously(){const e=i(),t=await G(e);return this.createSignInResult(t,null)}async signInWithApple(e){const t=new a(c.APPLE);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithCustomToken(e){const t=i(),r=await L(t,e.token);return this.createSignInResult(r,null)}async signInWithEmailAndPassword(e){const t=i(),r=await D(t,e.email,e.password);return this.createSignInResult(r,null)}async signInWithEmailLink(e){const t=i(),r=await V(t,e.email,e.emailLink);return this.createSignInResult(r,null)}async signInWithFacebook(e){const t=new d;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=d.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithGithub(e){const t=new h;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=h.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithGoogle(e){const t=new R;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=R.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithMicrosoft(e){const t=new a(c.MICROSOFT);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithOpenIdConnect(e){const t=new a(e.providerId);this.applySignInOptions(e,t);const r=await this.signInWithPopupOrRedirect(t,e.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithPhoneNumber(e){if(!e.phoneNumber)throw new Error(s.ERROR_PHONE_NUMBER_MISSING);if(!e.recaptchaVerifier||!(e.recaptchaVerifier instanceof w))throw new Error(s.ERROR_RECAPTCHA_VERIFIER_MISSING);const t=i();try{const r=await M(t,e.phoneNumber,e.recaptchaVerifier),{verificationId:n}=r;this.lastConfirmationResult.set(n,r);const o={verificationId:n};this.notifyListeners(s.PHONE_CODE_SENT_EVENT,o)}catch(r){const n={message:this.getErrorMessage(r)};this.notifyListeners(s.PHONE_VERIFICATION_FAILED_EVENT,n)}}async signInWithPlayGames(){this.throwNotAvailableError()}async signInWithGameCenter(){this.throwNotAvailableError()}async signInWithTwitter(e){const t=new I;this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=I.credentialFromResult(r);return this.createSignInResult(r,n)}async signInWithYahoo(e){const t=new a(c.YAHOO);this.applySignInOptions(e||{},t);const r=await this.signInWithPopupOrRedirect(t,e?.mode),n=a.credentialFromResult(r);return this.createSignInResult(r,n)}async signOut(){await i().signOut()}async unlink(e){const t=i();if(!t.currentUser)throw new Error(s.ERROR_NO_USER_SIGNED_IN);const r=await H(t.currentUser,e.providerId);return{user:this.createUserResult(r)}}async updateEmail(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return F(r,e.newEmail)}async updatePassword(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return B(r,e.newPassword)}async updateProfile(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return x(r,{displayName:e.displayName,photoURL:e.photoUrl})}async useAppLanguage(){i().useDeviceLanguage()}async useEmulator(e){const t=i(),r=e.port||9099,n=e.scheme||"http";e.host.includes("://")?p(t,`${e.host}:${r}`):p(t,`${n}://${e.host}:${r}`)}async verifyBeforeUpdateEmail(e){const r=i().currentUser;if(!r)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return $(r,e?.newEmail,e?.actionCodeSettings)}handleAuthStateChange(e){const r={user:this.createUserResult(e)};this.notifyListeners(s.AUTH_STATE_CHANGE_EVENT,r,!0)}async handleIdTokenChange(e){if(!e)return;const r={token:await e.getIdToken(!1)};this.notifyListeners(s.ID_TOKEN_CHANGE_EVENT,r,!0)}applySignInOptions(e,t){if(e.customParameters){const r={};e.customParameters.map(n=>{r[n.key]=n.value}),t.setCustomParameters(r)}if(e.scopes)for(const r of e.scopes)t.addScope(r)}signInWithPopupOrRedirect(e,t){const r=i();return t==="redirect"?Y(r,e):j(r,e)}linkCurrentUserWithPopupOrRedirect(e,t){const r=i();if(!r.currentUser)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return t==="redirect"?K(r.currentUser,e):q(r.currentUser,e)}linkCurrentUserWithCredential(e){const t=i();if(!t.currentUser)throw new Error(s.ERROR_NO_USER_SIGNED_IN);return J(t.currentUser,e)}requestAppTrackingTransparencyPermission(){this.throwNotAvailableError()}checkAppTrackingTransparencyPermission(){this.throwNotAvailableError()}createSignInResult(e,t){const r=this.createUserResult(e?.user||null),n=this.createCredentialResult(t),o=this.createAdditionalUserInfoResult(e);return{user:r,credential:n,additionalUserInfo:o}}createCredentialResult(e){if(!e)return null;const t={providerId:e.providerId};return e instanceof z&&(t.accessToken=e.accessToken,t.idToken=e.idToken,t.secret=e.secret),t}createUserResult(e){return e?{displayName:e.displayName,email:e.email,emailVerified:e.emailVerified,isAnonymous:e.isAnonymous,metadata:this.createUserMetadataResult(e.metadata),phoneNumber:e.phoneNumber,photoUrl:e.photoURL,providerData:this.createUserProviderDataResult(e.providerData),providerId:e.providerId,tenantId:e.tenantId,uid:e.uid}:null}createUserMetadataResult(e){const t={};return e.creationTime&&(t.creationTime=Date.parse(e.creationTime)),e.lastSignInTime&&(t.lastSignInTime=Date.parse(e.lastSignInTime)),t}createUserProviderDataResult(e){return e.map(t=>({displayName:t.displayName,email:t.email,phoneNumber:t.phoneNumber,photoUrl:t.photoURL,providerId:t.providerId,uid:t.uid}))}createAdditionalUserInfoResult(e){if(!e)return null;const t=Q(e);if(!t)return null;const{isNewUser:r,profile:n,providerId:o,username:u}=t,l={isNewUser:r};return o!==null&&(l.providerId=o),n!==null&&(l.profile=n),u!=null&&(l.username=u),l}getErrorMessage(e){return e instanceof Object&&"message"in e&&typeof e.message=="string"?e.message:JSON.stringify(e)}throwNotAvailableError(){throw new Error("Not available on web.")}}s.AUTH_STATE_CHANGE_EVENT="authStateChange";s.ID_TOKEN_CHANGE_EVENT="idTokenChange";s.PHONE_CODE_SENT_EVENT="phoneCodeSent";s.PHONE_VERIFICATION_FAILED_EVENT="phoneVerificationFailed";s.ERROR_NO_USER_SIGNED_IN="No user is signed in.";s.ERROR_PHONE_NUMBER_MISSING="phoneNumber must be provided.";s.ERROR_RECAPTCHA_VERIFIER_MISSING="recaptchaVerifier must be provided and must be an instance of RecaptchaVerifier.";s.ERROR_CONFIRMATION_RESULT_MISSING="No confirmation result with this verification id was found.";export{s as FirebaseAuthenticationWeb};
